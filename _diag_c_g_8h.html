<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quinoa: /tmp/TeamCity-12/work/821a9fd6f64749d9/src/Inciter/DiagCG.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quinoa.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Quinoa
   </div>
   <div id="projectbrief">Adaptive computational fluid dynamics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_606df7a4664720c111e6e5b0e11c4e03.html">Inciter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<div class="title">DiagCG.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>DiagCG for a PDE system with continuous Galerkin without a matrix.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;vector&gt;</code><br />
<code>#include &lt;map&gt;</code><br />
<code>#include &lt;unordered_set&gt;</code><br />
<code>#include &quot;QuinoaConfig.h&quot;</code><br />
<code>#include &quot;Types.h&quot;</code><br />
<code>#include &quot;<a class="el" href="_fields_8h_source.html">Fields.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_derived_data_8h_source.html">DerivedData.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_vector_reducer_8h_source.html">VectorReducer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_flux_corrector_8h_source.html">FluxCorrector.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_node_diagnostics_8h_source.html">NodeDiagnostics.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_inciter_2_input_deck_2_input_deck_8h_source.html">Inciter/InputDeck/InputDeck.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_face_data_8h_source.html">FaceData.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="diagcg_8decl_8h_source.html">NoWarning/diagcg.decl.h</a>&quot;</code><br />
</div>
<p><a href="_diag_c_g_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classinciter_1_1_diag_c_g.html">inciter::DiagCG</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classinciter_1_1_diag_c_g.html" title="DiagCG Charm++ chare array used to advance PDEs in time with DiagCG+LW+FCT. ">DiagCG</a> Charm++ chare array used to advance PDEs in time with DiagCG+LW+FCT.  <a href="classinciter_1_1_diag_c_g.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacetk"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacetk.html">tk</a></td></tr>
<tr class="memdesc:namespacetk"><td class="mdescLeft">&#160;</td><td class="mdescRight">Toolkit declarations and definitions for general purpose utilities. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespaceinciter"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceinciter.html">inciter</a></td></tr>
<tr class="memdesc:namespaceinciter"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inciter declarations and definitions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>DiagCG for a PDE system with continuous Galerkin without a matrix. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>2012-2015, J. Bakosi, 2016-2018, Los Alamos National Security, LLC.</dd></dl>
<p>DiagCG advances a system of partial differential equations (PDEs) using continuous Galerkin (CG) finite element (FE) spatial discretization (using linear shapefunctions on tetrahedron elements) combined with a time stepping scheme that is equivalent to the Lax-Wendroff (LW) scheme within the unstructured-mesh FE context and treats discontinuities with flux-corrected transport (FCT). The left-hand side (lumped-mass) matrix is diagonal thus this scheme does not use a matrix-based linear solver.</p>
<p>There are a potentially large number of DiagCG Charm++ chares created by Transporter. Each DiagCG gets a chunk of the full load (part of the mesh) and does the same: initializes and advances a number of PDE systems in time.</p>
<p>The implementation uses the Charm++ runtime system and is fully asynchronous, overlapping computation and communication. The algorithm utilizes the structured dagger (SDAG) Charm++ functionality. The high-level overview of the algorithm structure and how it interfaces with Charm++ is discussed in the Charm++ interface file <a class="el" href="diagcg_8ci.html">src/Inciter/diagcg.ci</a>.</p>
<h4>Call graph</h4>
<p>The following is a directed acyclic graph (DAG) that outlines the asynchronous algorithm implemented in this class The detailed discussion of the algorithm is given in the Charm++ interface file <a class="el" href="transporter_8ci.html">transporter.ci</a>, which also repeats the graph below using ASCII graphics. On the DAG orange fills denote global synchronization points that contain or eventually lead to global reductions. Dashed lines are potential shortcuts that allow jumping over some of the task-graph under some circumstances or optional code paths (taken, e.g., only in DEBUG mode). See the detailed discussion in <a class="el" href="diagcg_8ci.html">diagcg.ci</a>. </p><div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_2.svg" width="206" height="426"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
 <div class="fragment"><div class="line">// *****************************************************************************</div><div class="line">/*!</div><div class="line">  \file      src/Inciter/diagcg.ci</div><div class="line">  \copyright 2012-2015, J. Bakosi, 2016-2018, Los Alamos National Security, LLC.</div><div class="line">  \brief     Charm++ module interface for continuous Galerkin FEM w/o matrix</div><div class="line">  \details   Charm++ module interface file for the continuous Galerkin</div><div class="line">     discretization scheme using a diagonal matrix for the left hand side.</div><div class="line">  \see       DiagCG.h and DiagCG.C for more info.</div><div class="line">*/</div><div class="line">// *****************************************************************************</div><div class="line"></div><div class="line">module diagcg {</div><div class="line"></div><div class="line">  extern module transporter;</div><div class="line">  extern module discretization;</div><div class="line">  extern module solver;</div><div class="line"></div><div class="line">  include &quot;UnsMesh.h&quot;;</div><div class="line">  include &quot;PUPUtil.h&quot;;</div><div class="line">  include &quot;FaceData.h&quot;;</div><div class="line"></div><div class="line">  namespace inciter {</div><div class="line"></div><div class="line">    array [1D] DiagCG {</div><div class="line">      entry DiagCG( const CProxy_Discretization&amp; disc,</div><div class="line">                    const tk::CProxy_Solver&amp; solver,</div><div class="line">                    const FaceData&amp; fd );</div><div class="line">      initnode void registerReducers();</div><div class="line">      entry void setup( tk::real v );</div><div class="line">      entry void dt();</div><div class="line">      entry void eval();</div><div class="line">      entry [reductiontarget] void advance( tk::real newdt );</div><div class="line">      entry void comlhs( const std::vector&lt; std::size_t &gt;&amp; gid,</div><div class="line">                         const std::vector&lt; std::vector&lt; tk::real &gt; &gt;&amp; L );</div><div class="line">      entry void comrhs( const std::vector&lt; std::size_t &gt;&amp; gid,</div><div class="line">                         const std::vector&lt; std::vector&lt; tk::real &gt; &gt;&amp; R );</div><div class="line">      entry void comdif( const std::vector&lt; std::size_t &gt;&amp; gid,</div><div class="line">                         const std::vector&lt; std::vector&lt; tk::real &gt; &gt;&amp; D );</div><div class="line"></div><div class="line">      // SDAG code follows. See http://charm.cs.illinois.edu/manuals/html/</div><div class="line">      // charm++/manual.html, Sec. &quot;Structured Control Flow: Structured Dagger&quot;.</div><div class="line"></div><div class="line">      // High-level overview of the dependency and asynchronous call structure</div><div class="line">      // ---------------------------------------------------------------------</div><div class="line">      //</div><div class="line">      // Directed Acyclic Graph (DAG):</div><div class="line">      // -----------------------------</div><div class="line">      //</div><div class="line">      // See src/Inciter/DiagCG.h.</div><div class="line">      //</div><div class="line">      // Interpretation of the above DAG</div><div class="line">      // -------------------------------</div><div class="line">      // Control flow is from left to right and top to bottom.</div><div class="line">      //</div><div class="line">      // There are two parts of the DAG below: (1) setup: tasks leading to the</div><div class="line">      // start of time stepping, and (2) solve: tasks leading to solving the</div><div class="line">      // high and low order linear systems. Setup only happens once, while solve</div><div class="line">      // happens every time step.</div><div class="line">      //</div><div class="line">      // (1) Setup: The left hand side matrix (lumped-mass matrix, where only</div><div class="line">      // the diagonals are stored in a vector) are computed and assembled on the</div><div class="line">      // chare boundaries. Only when own contributions are complete and when</div><div class="line">      // chare-boundary contributions are received can timestepping start. This</div><div class="line">      // happens independently on each chare, communicating with their</div><div class="line">      // respective neighbors. Once the left hand side (diagonal) matrix is</div><div class="line">      // assembled it is assumed to never change during time stepping.</div><div class="line">      //</div><div class="line">      // (2) Solve: The right hand side vector contributions are computed and</div><div class="line">      // assembled on the chare boundaries. For the low order solution there is</div><div class="line">      // an additional, mass-diffusion, term added to the right hand side. Only</div><div class="line">      // when own contributions to both terms on the right hand side are</div><div class="line">      // complete and when chare-boundary contributions to both terms on the</div><div class="line">      // right hand side are received can the two systems be solved. This</div><div class="line">      // happens independently on each chare, communicating with their</div><div class="line">      // respective neighbors.</div><div class="line"></div><div class="line">      entry void wait4setup() {</div><div class="line">        when ownlhs_complete(), comlhs_complete() serial &quot;setup&quot; { start(); } };</div><div class="line"></div><div class="line">      entry void wait4rhs() {</div><div class="line">        when ownrhs_complete(), comrhs_complete(),</div><div class="line">             owndif_complete(), comdif_complete() serial &quot;rhs&quot; { solve(); } };</div><div class="line"></div><div class="line">      entry void ownlhs_complete();</div><div class="line">      entry void ownrhs_complete();</div><div class="line">      entry void owndif_complete();</div><div class="line">      entry void comlhs_complete();</div><div class="line">      entry void comrhs_complete();</div><div class="line">      entry void comdif_complete();</div><div class="line">    };</div><div class="line"></div><div class="line">  } // inciter::</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> 
<p class="definition">Definition in file <a class="el" href="_diag_c_g_8h_source.html">DiagCG.h</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jul 27 2018 14:55:39 for Quinoa by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
