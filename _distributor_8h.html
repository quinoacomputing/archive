<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quinoa: /tmp/q/quinoa/src/Walker/Distributor.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quinoa.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Quinoa
   </div>
   <div id="projectbrief">Adaptive computational fluid dynamics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_d2020816e1e75d657315e6db54e3d24d.html">Walker</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<div class="title">Distributor.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Distributor drives the time integration of differential equations.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;vector&gt;</code><br />
<code>#include &lt;map&gt;</code><br />
<code>#include &lt;iosfwd&gt;</code><br />
<code>#include &lt;cstdint&gt;</code><br />
<code>#include &quot;Types.h&quot;</code><br />
<code>#include &quot;<a class="el" href="_timer_8h_source.html">Timer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_tags_8h_source.html">Tags.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_table_8h_source.html">Table.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_tagged_tuple_8h_source.html">TaggedTuple.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_stat_ctr_8h_source.html">StatCtr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_uni_p_d_f_8h_source.html">UniPDF.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_bi_p_d_f_8h_source.html">BiPDF.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_tri_p_d_f_8h_source.html">TriPDF.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_walker_print_8h_source.html">WalkerPrint.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_walker_2_cmd_line_2_cmd_line_8h_source.html">Walker/CmdLine/CmdLine.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="integrator_8decl_8h_source.html">NoWarning/integrator.decl.h</a>&quot;</code><br />
</div>
<p><a href="_distributor_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwalker_1_1_distributor.html">walker::Distributor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classwalker_1_1_distributor.html" title="Distributor drives the time integration of differential equations. ">Distributor</a> drives the time integration of differential equations.  <a href="classwalker_1_1_distributor.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacewalker"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewalker.html">walker</a></td></tr>
<tr class="memdesc:namespacewalker"><td class="mdescLeft">&#160;</td><td class="mdescRight">Walker declarations and definitions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Distributor drives the time integration of differential equations. </p>
<dl class="section author"><dt>Author</dt><dd>J. Bakosi </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2012-2015, Jozsef Bakosi, 2016, Los Alamos National Security, LLC.</dd></dl>
<p>Distributor drives the time integration of differential equations. The implementation uses the Charm++ runtime system and is fully asynchronous, overlapping computation, communication as well as I/O. The algorithm utilizes the structured dagger (SDAG) Charm++ functionality. The high-level overview of the algorithm structure and how it interfaces with Charm++ is discussed in the Charm++ interface file <a class="el" href="distributor_8ci.html">src/Walker/distributor.ci</a>.</p>
<h4>Call graph</h4>
<p>The following is a directed acyclic graph (DAG) that outlines the asynchronous algorithm implemented in this class The detailed discussion of the algorithm is given in the Charm++ interface file <a class="el" href="distributor_8ci.html">distributor.ci</a>, which also repeats the graph below using ASCII graphics. On the DAG orange fills denote global synchronization points, orange frames with white fill are partial synchronization points that overlap with other tasks, and dashed lines are potential shortcuts that allow jumping over some of the task-graph under some circumstances. See the detailed discussion in <a class="el" href="distributor_8ci.html">distributor.ci</a>. </p><div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_5.svg" width="639" height="230"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
 <div class="fragment"><div class="line">// *****************************************************************************</div><div class="line">/*!</div><div class="line">  \file      src/Walker/distributor.ci</div><div class="line">  \author    J. Bakosi</div><div class="line">  \copyright 2012-2015, Jozsef Bakosi, 2016, Los Alamos National Security, LLC.</div><div class="line">  \brief     Charm++ module interface file for Distributor</div><div class="line">  \details   Charm++ module interface file for Distributor</div><div class="line">*/</div><div class="line">// *****************************************************************************</div><div class="line"></div><div class="line">module distributor {</div><div class="line"></div><div class="line">  include &quot;UniPDF.h&quot;;</div><div class="line">  include &quot;BiPDF.h&quot;;</div><div class="line">  include &quot;TriPDF.h&quot;;</div><div class="line">  include &quot;Walker/CmdLine/CmdLine.h&quot;;</div><div class="line"></div><div class="line">  namespace walker {</div><div class="line"></div><div class="line">    chare Distributor {</div><div class="line">      entry Distributor( const ctr::CmdLine&amp; cmdline );</div><div class="line">      entry [reductiontarget] void registered();</div><div class="line">      entry [reductiontarget] void nostat();</div><div class="line">      entry [reductiontarget] void estimateOrd( tk::real ord[n], int n );</div><div class="line">      entry [reductiontarget] void estimateCen( tk::real cen[n], int n );</div><div class="line">      entry [reductiontarget] void estimateOrdPDF( CkReductionMsg* msg );</div><div class="line">      entry [reductiontarget] void estimateCenPDF( CkReductionMsg* msg );</div><div class="line"></div><div class="line">      // SDAG code follows. See http://charm.cs.illinois.edu/manuals/html/</div><div class="line">      // charm++/manual.html, Sec. &quot;Structured Control Flow: Structured Dagger&quot;.</div><div class="line"></div><div class="line">      // High-level overview of the dependency and asynchronous call structure</div><div class="line">      // ---------------------------------------------------------------------</div><div class="line">      //</div><div class="line">      // Directed Acyclic Graph (DAG):        DAG legend:</div><div class="line">      // -----------------------------          AdvP - advance particles</div><div class="line">      //                                        OrdM - estimate ordinary moments</div><div class="line">      // AdvP -- OrdM -- CenM -- OutS           CenM - estimate central moments</div><div class="line">      //  |  \       \             |            OrdP - estimate ordinary PDFs</div><div class="line">      //   \  OrdP    CenP         |            CenP - estimate central PDFs</div><div class="line">      //    \   \       \          |            OutS - output statistics (mom)</div><div class="line">      //     \    ------ OutP -- EvT            OutP - output PDFs</div><div class="line">      //      \                   /             EvT  - Evaluate time step</div><div class="line">      //        ---- NoSt ------ /              NoSt - No stats &amp; nor PDFs</div><div class="line">      //</div><div class="line">      // Interpretation of the above DAG</div><div class="line">      // -------------------------------</div><div class="line">      // Control flow is from left to right and top to bottom. In the discussion</div><div class="line">      // below, concentrate first on the first three lines and ignore NoSt for</div><div class="line">      // the moment - those will be discussed at the very end.</div><div class="line">      //</div><div class="line">      // After initialization a time step starts by advancing all particles</div><div class="line">      // (AdvP, Integrator::advance()). When that is finished (no global</div><div class="line">      // synchronization), each PE starts with the estimation of its portion of</div><div class="line">      // the ordinary moments (OrdM). When a PE finished with its part of the</div><div class="line">      // estimation of the ordinary moments, it calls back to its host,</div><div class="line">      // Distributor, which collects statistics from all PEs. When a PE has</div><div class="line">      // finished its accumulation of ordinary moments and has sent its</div><div class="line">      // contribution to its host, it immediately continues with estimation of</div><div class="line">      // ordinary PDFs (OrdP) (if any), and does not wait for its host.</div><div class="line">      //</div><div class="line">      // Understanding &#39;wait4ord&#39;. Once the host has finished collecting</div><div class="line">      // partially accumulated ordinary moment (sums) from all PEs, it signals</div><div class="line">      // Charm++ SDAG runtime that all ordinary moments are updated and the</div><div class="line">      // estimation of central moments and PDFs can start. This is a necessary</div><div class="line">      // synchronization point (central moments can only be estimated about some</div><div class="line">      // ordinary moments, i.e., means), realized by two steps: (1) starting off</div><div class="line">      // the entry &#39;wait4ord&#39; (before the time step), which waits for the SDAG</div><div class="line">      // signal &#39;estimateOrdDone&#39;, sent by the host. Once the SDAG signal is in,</div><div class="line">      // as step (2), the request to start the accumulation of the central</div><div class="line">      // moments (CenM) are asynchronously fired off to all PEs followed by a</div><div class="line">      // similar request for the central PDFs (CenP) (if any). Once a PE has</div><div class="line">      // finished its part of the accumuluation of the central moments, it sends</div><div class="line">      // its portion of the sums back to its host which collects from all PEs</div><div class="line">      // and finishes the estimation.</div><div class="line">      //</div><div class="line">      // Understanding &#39;wait4cen&#39;. Once the host has finished collecting</div><div class="line">      // partially accumulated central moment (sums) from all PEs, it signals</div><div class="line">      // Charm++ SDAG runtime that all central moments are updated and the</div><div class="line">      // statistics (moments) are ready to be written to disk (OutS) (if</div><div class="line">      // scheduled in this step). This is also a necessary synchronization point</div><div class="line">      // and done similarly to the one discussed above, but this time by</div><div class="line">      // &#39;wait4cen&#39; and &#39;estimateCenDone&#39;. Since there may not be any PDFs</div><div class="line">      // estimated, having finished estimating the central moments may finish</div><div class="line">      // the time step and &#39;evalulateTime&#39; can be called (EvT). If PDFs are</div><div class="line">      // estimated evaluateTyme is called only after the PDFs have been</div><div class="line">      // estimated.</div><div class="line">      //</div><div class="line">      // Understanding &#39;wait4pdf&#39;. Once a PE has finished its part of the</div><div class="line">      // accumuluation of the central PDFs (started from &#39;wait4ord&#39;), it sends</div><div class="line">      // its portion of the sums back to its host which collects from all PEs</div><div class="line">      // and finishes the estimation. The host then signals Charm++ SDAG</div><div class="line">      // runtime that all central PDFs have been estimated. This is also a</div><div class="line">      // necessary synchronization point and done similarly to the ones</div><div class="line">      // discussed above, but this time by &#39;wait4pdf&#39; waiting for two signals,</div><div class="line">      // &#39;estimateOrdPDFDone&#39; and &#39;estimateCenPDFDone&#39;. Both the estimation of</div><div class="line">      // ordinary and central PDFs must have completed in order to be possible</div><div class="line">      // to be written out to disk (OutP) (if scheduled in this time step).</div><div class="line">      // According to the logical &#39;and&#39; relationship here, two &#39;when&#39; keywords</div><div class="line">      // are given in &#39;wait4pdf&#39;. This enables overlapping OrdP with everything</div><div class="line">      // else discussed thus far.</div><div class="line">      //</div><div class="line">      // The resulting algorithm for a single time step enables overlapping</div><div class="line">      // computations, communications as well as I/O. The algorithm has two</div><div class="line">      // global synchronization points: (1) it must wait for all particles to be</div><div class="line">      // advanced (AdvP), and (2) the final evaluateTime() (EvT) can only happen</div><div class="line">      // once all required statistics and PDFs have been estimated and</div><div class="line">      // optionally written to disk. Furthermore, there are three partial</div><div class="line">      // synchronization points: (1) since central moments and central PDFs can</div><div class="line">      // only be estimated about already estimated (and collected) ordinary</div><div class="line">      // moments, there is a barrier at OrdM, but this is overlapped with OrdP,</div><div class="line">      // (2) since statistics (moments) can only be output to disk if they all</div><div class="line">      // have been estimated and collected, there is a barrier at CenM, but this</div><div class="line">      // is overlapped with OrdP, CenP, and OutP, and (3) since PDFs can only be</div><div class="line">      // output to disk if they all have been estimated and collected, there is</div><div class="line">      // a barrier at CenP, but this is overlapped with OrdP, CenM, and OutS.</div><div class="line">      //</div><div class="line">      // NoSt in the graph signals a potential shortcut which is activated if</div><div class="line">      // there are no statistics nor PDFs need to be estimated. In that case,</div><div class="line">      // after advancing the particles, control flow just to evaluating the time</div><div class="line">      // step, skipping over several synchronization points.</div><div class="line">      //</div><div class="line">      // Similar to NoSt, the estimateion of the PDFs can also be potentially</div><div class="line">      // skipped. This happens when either the the user did not request any PDF</div><div class="line">      // estimation or the interval for estimating and outputing PDFs is such</div><div class="line">      // that at the given time step PDFs are not estimated. (Estimation of</div><div class="line">      // PDFs, especially multi-dimensional ones, can be quite costly, and thus</div><div class="line">      // PDF estimation is recommended only at certain intervals, i.e., not</div><div class="line">      // every time step.) If the shortcut is activated due to no PDF esimation,</div><div class="line">      // the control flow in wait4cen() skips ahead to evaluate time, i.e.,</div><div class="line">      // finish the time step, after the central moments (if any) have been</div><div class="line">      // estimated. Similarly, of the shortcut is activated due to no PDF</div><div class="line">      // estimation, the control flow in wait4ord() skips the estimation of</div><div class="line">      // central PDFs.</div><div class="line"></div><div class="line">      // SDAG wait-for: wait for ordinary moments to have been estimated</div><div class="line">      entry void wait4ord() {</div><div class="line">        when estimateOrdDone() serial &quot;accumulateCen&quot; {</div><div class="line">          // Start accumulating sums for central moments (every time step)</div><div class="line">          m_intproxy.accumulateCen( m_ordinary );</div><div class="line">          // Start accumulating sums for central PDFs at select times</div><div class="line">          if ( g_inputdeck.pdf() &amp;&amp;</div><div class="line">               !((m_it+1) % g_inputdeck.get&lt; tag::interval, tag::pdf &gt;()) )</div><div class="line">            m_intproxy.accumulateCenPDF( m_ordinary );</div><div class="line">        }</div><div class="line">      };</div><div class="line"></div><div class="line">      // SDAG wait-for: wait for central moments to have been estimated</div><div class="line">      entry void wait4cen() {</div><div class="line">        when estimateCenDone() serial &quot;outStat&quot; {</div><div class="line">          // Output statistics to file</div><div class="line">          outStat();</div><div class="line">          // If PDFs not estimated, evaluate time step</div><div class="line">          if ( !g_inputdeck.pdf() ||</div><div class="line">                (m_it+1) % g_inputdeck.get&lt; tag::interval, tag::pdf &gt;() )</div><div class="line">            evaluateTime();</div><div class="line">        }</div><div class="line">      };</div><div class="line"></div><div class="line">      // SDAG wait-for: wait for PDFs to have been estimated, the two &#39;when&#39;</div><div class="line">      // statements are undestood with a logical AND between them</div><div class="line">      entry void wait4pdf() {</div><div class="line">        when estimateOrdPDFDone()</div><div class="line">        when estimateCenPDFDone() serial &quot;outPDF&quot; {</div><div class="line">          outPDF();             // output PDFs to file</div><div class="line">          evaluateTime();       // evaluate time step, compute new time step</div><div class="line">        }</div><div class="line">      };</div><div class="line"></div><div class="line">      // SDAG trigger signaling that ordinary moments have been estimated</div><div class="line">      entry void estimateOrdDone();</div><div class="line">      // SDAG trigger signaling that central moments have been estimated</div><div class="line">      entry void estimateCenDone();</div><div class="line">      // SDAG trigger signaling that ordinary PDFs have been estimated</div><div class="line">      entry void estimateOrdPDFDone();</div><div class="line">      // SDAG trigger signaling that central PDFs have been estimated</div><div class="line">      entry void estimateCenPDFDone();</div><div class="line">    }</div><div class="line"></div><div class="line">  } // walker::</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> 
<p class="definition">Definition in file <a class="el" href="_distributor_8h_source.html">Distributor.h</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 7 2017 06:03:29 for Quinoa by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
