
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - [<a href="https://github.com/quinoacomputing/quinoa/commit/337b83b9">Quinoa_v0.1-727-g337b83b9</a>]</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script language="javascript">
      function getStyle(el,styleProp) {
        if (el.currentStyle)
          var y = el.currentStyle[styleProp];
        else if (window.getComputedStyle)
          var y = document.defaultView.getComputedStyle(el,null).getPropertyValue(styleProp);
        return y;
      }
      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;
        if (el.style.display == "block") {
          el.style.display = "none";
          mark.innerHTML = "[+]";
        } else {
          el.style.display = "block";
          mark.innerHTML = "[-]";
        }
      }
      function init_expandables() {
        var elts = document.getElementsByClassName("expandable");
        for (var i = 0; i < elts.length; i++) {
          var el = elts[i];
          var clickable = el.getElementsByTagName("span")[0];
          var marker = clickable.getElementsByClassName("marker")[0];
          var content = el.getElementsByClassName("content")[0];
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.onclick = toggle;
        }
      }
      function set_class_display(c, st) {
        var elements = document.querySelectorAll('.' + c),
            len = elements.length;
        for (i = 0; i < len; i++) {
            elements[i].style.display = st;
        }
      }
      function toggle_class_visibility(id) {
        var box = document.getElementById(id);
        set_class_display(id, box.checked ? '' : 'none');
      }
    </script>
  </head>
  <body onload="init_expandables()">
      <div id="header">
        <h1>Cppcheck report - [<a href="https://github.com/quinoacomputing/quinoa/commit/337b83b9">Quinoa_v0.1-727-g337b83b9</a>]: /tmp/q/quinoa/src/Main/UnitTest.C </h1>
      </div>
      <div id="menu" dir="rtl">
       <p id="filename"><a href="index.html">Defects:</a> UnitTest.C</p>
<a href='15.html#line-178'> noConstructor 178</a>
      </div>
      <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="c1">// *****************************************************************************</span>
<a name="line-2"></a><span class="cm">/*!</span>
<a name="line-3"></a><span class="cm">  \file      src/Main/UnitTest.C</span>
<a name="line-4"></a><span class="cm">  \author    J. Bakosi</span>
<a name="line-5"></a><span class="cm">  \date      Fri 13 Jan 2017 10:39:27 AM MST</span>
<a name="line-6"></a><span class="cm">  \copyright 2012-2015, Jozsef Bakosi, 2016, Los Alamos National Security, LLC.</span>
<a name="line-7"></a><span class="cm">  \brief     UnitTest&#39;s Charm++ main chare and main().</span>
<a name="line-8"></a><span class="cm">  \details   UnitTest&#39;s Charm++ main chare and main(). This file contains</span>
<a name="line-9"></a><span class="cm">    the definition of the Charm++ main chare, equivalent to main() in Charm++-</span>
<a name="line-10"></a><span class="cm">    land, running the serial and Charm++ unit tests as well as the ordinary</span>
<a name="line-11"></a><span class="cm">    main() function, running the MPI unit test suite.</span>
<a name="line-12"></a><span class="cm">*/</span>
<a name="line-13"></a><span class="c1">// *****************************************************************************</span>
<a name="line-14"></a>
<a name="line-15"></a><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp"></span>
<a name="line-16"></a><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<a name="line-17"></a><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<a name="line-18"></a><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<a name="line-19"></a><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"></span>
<a name="line-20"></a><span class="cp">#include</span> <span class="cpf">&lt;cstddef&gt;</span><span class="cp"></span>
<a name="line-21"></a>
<a name="line-22"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/tut_result.h&quot;</span><span class="cp"></span>
<a name="line-23"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/tut_runner.h&quot;</span><span class="cp"></span>
<a name="line-24"></a>
<a name="line-25"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/charm.h&quot;</span><span class="cp"></span>
<a name="line-26"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/mpi.h&quot;</span><span class="cp"></span>
<a name="line-27"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/mpi-interoperate.h&quot;</span><span class="cp"></span>
<a name="line-28"></a>
<a name="line-29"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/tutsuite.decl.h&quot;</span><span class="cp"></span>
<a name="line-30"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/unittest.decl.h&quot;</span><span class="cp"></span>
<a name="line-31"></a>
<a name="line-32"></a><span class="cp">#include</span> <span class="cpf">&quot;Print.h&quot;</span><span class="cp"></span>
<a name="line-33"></a><span class="cp">#include</span> <span class="cpf">&quot;Timer.h&quot;</span><span class="cp"></span>
<a name="line-34"></a><span class="cp">#include</span> <span class="cpf">&quot;Tags.h&quot;</span><span class="cp"></span>
<a name="line-35"></a><span class="cp">#include</span> <span class="cpf">&quot;Exception.h&quot;</span><span class="cp"></span>
<a name="line-36"></a><span class="cp">#include</span> <span class="cpf">&quot;Init.h&quot;</span><span class="cp"></span>
<a name="line-37"></a><span class="cp">#include</span> <span class="cpf">&quot;QuinoaConfig.h&quot;</span><span class="cp"></span>
<a name="line-38"></a><span class="cp">#include</span> <span class="cpf">&quot;HelpFactory.h&quot;</span><span class="cp"></span>
<a name="line-39"></a><span class="cp">#include</span> <span class="cpf">&quot;Assessment.h&quot;</span><span class="cp"></span>
<a name="line-40"></a><span class="cp">#include</span> <span class="cpf">&quot;ProcessException.h&quot;</span><span class="cp"></span>
<a name="line-41"></a><span class="cp">#include</span> <span class="cpf">&quot;UnitTest/CmdLine/CmdLine.h&quot;</span><span class="cp"></span>
<a name="line-42"></a><span class="cp">#include</span> <span class="cpf">&quot;TestArray.h&quot;</span><span class="cp"></span>
<a name="line-43"></a><span class="cp">#include</span> <span class="cpf">&quot;UnitTestPrint.h&quot;</span><span class="cp"></span>
<a name="line-44"></a><span class="cp">#include</span> <span class="cpf">&quot;UnitTestDriver.h&quot;</span><span class="cp"></span>
<a name="line-45"></a><span class="cp">#include</span> <span class="cpf">&quot;UnitTest/CmdLine/Parser.h&quot;</span><span class="cp"></span>
<a name="line-46"></a>
<a name="line-47"></a><span class="k">namespace</span> <span class="n">tut</span> <span class="p">{</span>
<a name="line-48"></a>
<a name="line-49"></a><span class="c1">//! \brief Maximum number of tests in every test group to attempt to run</span>
<a name="line-50"></a><span class="c1">//! \details If any of the unit test groups have more tests than this number,</span>
<a name="line-51"></a><span class="c1">//!   this should be increased. All test groups included below will use this</span>
<a name="line-52"></a><span class="c1">//!   value to override the default template argument for tut::test_group&lt;&gt;.</span>
<a name="line-53"></a><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_TESTS_IN_GROUP</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
<a name="line-54"></a>
<a name="line-55"></a><span class="p">}</span> <span class="c1">// tut::</span>
<a name="line-56"></a>
<a name="line-57"></a><span class="c1">// // Unit test groups to be tested. Each file defines a different test group.</span>
<a name="line-58"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestCharmUtil.h&quot;</span><span class="cp"></span>
<a name="line-59"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestFactory.h&quot;</span><span class="cp"></span>
<a name="line-60"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestTimer.h&quot;</span><span class="cp"></span>
<a name="line-61"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestPUPUtil.h&quot;</span><span class="cp"></span>
<a name="line-62"></a>
<a name="line-63"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestFlip_map.h&quot;</span><span class="cp"></span>
<a name="line-64"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestMake_list.h&quot;</span><span class="cp"></span>
<a name="line-65"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestHas.h&quot;</span><span class="cp"></span>
<a name="line-66"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestData.h&quot;</span><span class="cp"></span>
<a name="line-67"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestPrint.h&quot;</span><span class="cp"></span>
<a name="line-68"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestTaggedTuple.h&quot;</span><span class="cp"></span>
<a name="line-69"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestException.h&quot;</span><span class="cp"></span>
<a name="line-70"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestExceptionMPI.h&quot;</span><span class="cp"></span>
<a name="line-71"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestReader.h&quot;</span><span class="cp"></span>
<a name="line-72"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestStrConvUtil.h&quot;</span><span class="cp"></span>
<a name="line-73"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestWriter.h&quot;</span><span class="cp"></span>
<a name="line-74"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestProcessControl.h&quot;</span><span class="cp"></span>
<a name="line-75"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestVector.h&quot;</span><span class="cp"></span>
<a name="line-76"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Base/TestContainerUtil.h&quot;</span><span class="cp"></span>
<a name="line-77"></a>
<a name="line-78"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Control/TestSystemComponents.h&quot;</span><span class="cp"></span>
<a name="line-79"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Control/TestControl.h&quot;</span><span class="cp"></span>
<a name="line-80"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Control/TestFileParser.h&quot;</span><span class="cp"></span>
<a name="line-81"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Control/TestStringParser.h&quot;</span><span class="cp"></span>
<a name="line-82"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Control/TestToggle.h&quot;</span><span class="cp"></span>
<a name="line-83"></a><span class="cp">#ifdef HAS_MKL</span>
<a name="line-84"></a>  <span class="cp">#include</span> <span class="cpf">&quot;tests/Control/Options/TestMKLUniformMethod.h&quot;</span><span class="cp"></span>
<a name="line-85"></a>  <span class="cp">#include</span> <span class="cpf">&quot;tests/Control/Options/TestMKLGaussianMethod.h&quot;</span><span class="cp"></span>
<a name="line-86"></a>  <span class="cp">#include</span> <span class="cpf">&quot;tests/Control/Options/TestMKLBetaMethod.h&quot;</span><span class="cp"></span>
<a name="line-87"></a><span class="cp">#endif</span>
<a name="line-88"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Control/Options/TestRNG.h&quot;</span><span class="cp"></span>
<a name="line-89"></a>
<a name="line-90"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/IO/TestMesh.h&quot;</span><span class="cp"></span>
<a name="line-91"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/IO/TestExodusIIMeshReader.h&quot;</span><span class="cp"></span>
<a name="line-92"></a>
<a name="line-93"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/Mesh/TestDerivedData.h&quot;</span><span class="cp"></span>
<a name="line-94"></a>
<a name="line-95"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/RNG/TestRNG.h&quot;</span><span class="cp"></span>
<a name="line-96"></a><span class="cp">#ifdef HAS_MKL</span>
<a name="line-97"></a>  <span class="cp">#include</span> <span class="cpf">&quot;tests/RNG/TestMKLRNG.h&quot;</span><span class="cp"></span>
<a name="line-98"></a><span class="cp">#endif</span>
<a name="line-99"></a><span class="cp">#ifdef HAS_RNGSSE2</span>
<a name="line-100"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/RNG/TestRNGSSE.h&quot;</span><span class="cp"></span>
<a name="line-101"></a><span class="cp">#endif</span>
<a name="line-102"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/RNG/TestRandom123.h&quot;</span><span class="cp"></span>
<a name="line-103"></a>
<a name="line-104"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/LoadBalance/TestLoadDistributor.h&quot;</span><span class="cp"></span>
<a name="line-105"></a><span class="c1">// Disabled due to API change.</span>
<a name="line-106"></a><span class="c1">// See https://lists.cs.illinois.edu/lists/arc/charm/2017-01/msg00018.html.</span>
<a name="line-107"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/LoadBalance/TestLinearMap.h&quot;</span><span class="cp"></span>
<a name="line-108"></a><span class="cp">#include</span> <span class="cpf">&quot;tests/LoadBalance/TestUnsMeshMap.h&quot;</span><span class="cp"></span>
<a name="line-109"></a>
<a name="line-110"></a><span class="cp">#if defined(__clang__)</span>
<a name="line-111"></a>  <span class="cp">#pragma clang diagnostic push</span>
<a name="line-112"></a>  <span class="cp">#pragma clang diagnostic ignored &quot;-Wmissing-variable-declarations&quot;</span>
<a name="line-113"></a><span class="cp">#endif</span>
<a name="line-114"></a>
<a name="line-115"></a><span class="c1">//! \brief Charm handle to the main proxy, facilitates call-back to finalize,</span>
<a name="line-116"></a><span class="c1">//!    etc., must be in global scope, unique per executable</span>
<a name="line-117"></a><span class="n">CProxy_Main</span> <span class="n">mainProxy</span><span class="p">;</span>
<a name="line-118"></a>
<a name="line-119"></a><span class="cp">#if defined(__clang__)</span>
<a name="line-120"></a>  <span class="cp">#pragma clang diagnostic pop</span>
<a name="line-121"></a><span class="cp">#endif</span>
<a name="line-122"></a>
<a name="line-123"></a><span class="c1">//! UnitTest declarations and definitions</span>
<a name="line-124"></a><span class="k">namespace</span> <span class="n">unittest</span> <span class="p">{</span>
<a name="line-125"></a>
<a name="line-126"></a><span class="c1">//! Global-scope data. Initialized by the main chare and distibuted to all PEs</span>
<a name="line-127"></a><span class="c1">//! by the Charm++ runtime system. Though semantically not const, all these</span>
<a name="line-128"></a><span class="c1">//! global data should be considered read-only. See also</span>
<a name="line-129"></a><span class="c1">//! http://charm.cs.illinois.edu/manuals/html/charm++/manual.html. The data</span>
<a name="line-130"></a><span class="c1">//! below is global-scope because they must be available to all PEs which could</span>
<a name="line-131"></a><span class="c1">//! be on different machines.</span>
<a name="line-132"></a>
<a name="line-133"></a><span class="cp">#if defined(__clang__)</span>
<a name="line-134"></a>  <span class="cp">#pragma clang diagnostic push</span>
<a name="line-135"></a>  <span class="cp">#pragma clang diagnostic ignored &quot;-Wmissing-variable-declarations&quot;</span>
<a name="line-136"></a><span class="cp">#endif</span>
<a name="line-137"></a>
<a name="line-138"></a><span class="c1">//! Template Unit Test test runner</span>
<a name="line-139"></a><span class="n">tut</span><span class="o">::</span><span class="n">test_runner_singleton</span> <span class="n">g_runner</span><span class="p">;</span>
<a name="line-140"></a>
<a name="line-141"></a><span class="c1">//! Test suite Charm++ proxy facilitating call-back to unit test suite by</span>
<a name="line-142"></a><span class="c1">//! individual unit tests spawning Charm++ chares</span>
<a name="line-143"></a><span class="n">CProxy_TUTSuite</span> <span class="n">g_suiteProxy</span><span class="p">;</span>
<a name="line-144"></a>
<a name="line-145"></a><span class="c1">//! UnitTest executable name. So that FileParser&#39;s unit tests can access a file</span>
<a name="line-146"></a><span class="c1">//! for opening.</span>
<a name="line-147"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">g_executable</span><span class="p">;</span>
<a name="line-148"></a>
<a name="line-149"></a><span class="c1">//! Max number of tests in every group</span>
<a name="line-150"></a><span class="kt">int</span> <span class="n">g_maxTestsInGroup</span> <span class="o">=</span> <span class="n">tut</span><span class="o">::</span><span class="n">MAX_TESTS_IN_GROUP</span><span class="p">;</span>
<a name="line-151"></a>
<a name="line-152"></a><span class="c1">//! Bool indicating whether all Charm++ and serial tests have passed</span>
<a name="line-153"></a><span class="kt">bool</span> <span class="n">g_charmpass</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<a name="line-154"></a>
<a name="line-155"></a><span class="cp">#if defined(__clang__)</span>
<a name="line-156"></a>  <span class="cp">#pragma clang diagnostic pop</span>
<a name="line-157"></a><span class="cp">#endif</span>
<a name="line-158"></a>
<a name="line-159"></a><span class="c1">//! Pack/Unpack test runner. This Pack/Unpack method (re-)creates the</span>
<a name="line-160"></a><span class="c1">//! test runner singleton on all processing elements. Therefore we circumvent</span>
<a name="line-161"></a><span class="c1">//! Charm&#39;s usual pack/unpack for this type, and thus sizing does not make</span>
<a name="line-162"></a><span class="c1">//! sense: sizing is a no-op. We could initialize the stack in UnitTestDriver&#39;s</span>
<a name="line-163"></a><span class="c1">//! constructor and let this function re-create the runner only when unpacking,</span>
<a name="line-164"></a><span class="c1">//! but that leads to repeating the same code twice: once in UnitTestDriver&#39;s</span>
<a name="line-165"></a><span class="c1">//! constructor, once here. Another option is to use this pack/unpack routine to</span>
<a name="line-166"></a><span class="c1">//! both initially create (when packing) and to re-create (when unpacking) the</span>
<a name="line-167"></a><span class="c1">//! runner, which eliminates the need for pre-creating the object in</span>
<a name="line-168"></a><span class="c1">//! UnitTestDriver&#39;s constructor and therefore eliminates the repeated code.</span>
<a name="line-169"></a><span class="c1">//! This explains the guard for sizing: the code below is called for packing</span>
<a name="line-170"></a><span class="c1">//! only (in serial) and packing and unpacking (in parallel).</span>
<a name="line-171"></a><span class="kr">inline</span> <span class="kt">void</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span> <span class="n">PUP</span><span class="o">::</span><span class="n">er</span><span class="o">&amp;</span> <span class="n">p</span><span class="p">,</span> <span class="n">tut</span><span class="o">::</span><span class="n">test_runner_singleton</span><span class="o">&amp;</span> <span class="n">runner</span> <span class="p">)</span>
<a name="line-172"></a><span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">.</span><span class="n">isSizing</span><span class="p">())</span> <span class="n">runner</span> <span class="o">=</span> <span class="n">tut</span><span class="o">::</span><span class="n">test_runner_singleton</span><span class="p">();</span> <span class="p">}</span>
<a name="line-173"></a>
<a name="line-174"></a><span class="p">}</span> <span class="c1">// unittest::</span>
<a name="line-175"></a>
<a name="line-176"></a><span class="c1">//! \brief Charm++ main chare for the unit test suite executable, unittest.</span>
<a name="line-177"></a><span class="c1">//! \details Note that this object should not be in a namespace.</span>
<a name="line-178"></a><span class="hll"><span class="k">class</span> <span class="nc">Main</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CBase_Main</span> <span class="p">{</span><div class='verbose expandable'><span class='error2'>&lt;--- The class 'Main' does not have a constructor. <span class='marker'>[+]</span></span><div class='content'>The class &apos;Main&apos; does not have a constructor although it has private member variables. Member variables of builtin types are left uninitialized when the class is instantiated. That may cause bugs or undefined behavior.</div></div>
</span><a name="line-179"></a>
<a name="line-180"></a>  <span class="k">public</span><span class="o">:</span>
<a name="line-181"></a>    <span class="c1">//! \brief Constructor</span>
<a name="line-182"></a>    <span class="c1">//! \details The main chare constructor is the main entry point of the</span>
<a name="line-183"></a>    <span class="c1">//!   program, called by the Charm++ runtime system. The constructor does</span>
<a name="line-184"></a>    <span class="c1">//!   basic initialization steps, e.g., parser the command-line, prints out</span>
<a name="line-185"></a>    <span class="c1">//!   some useful information to screen (in verbose mode), and instantiates</span>
<a name="line-186"></a>    <span class="c1">//!   a driver. Since Charm++ is fully asynchronous, the constructor</span>
<a name="line-187"></a>    <span class="c1">//!   usually spawns asynchronous objects and immediately exits. Thus in the</span>
<a name="line-188"></a>    <span class="c1">//!   body of the main chare constructor we fire up an &#39;execute&#39; chare,</span>
<a name="line-189"></a>    <span class="c1">//!   which then calls back to Main::execute(). Finishing the main chare</span>
<a name="line-190"></a>    <span class="c1">//!   constructor the Charm++ runtime system then starts the</span>
<a name="line-191"></a>    <span class="c1">//!   network-migration of all global-scope data (if any). The execute chare</span>
<a name="line-192"></a>    <span class="c1">//!   calling back to Main::execute() signals the end of the migration of</span>
<a name="line-193"></a>    <span class="c1">//!   the global-scope data. Then we are ready to execute the driver. Since</span>
<a name="line-194"></a>    <span class="c1">//!   the unit test suite is parallel and asynchronous, its driver fires up</span>
<a name="line-195"></a>    <span class="c1">//!   additional Charm++ chare objects which then call back to</span>
<a name="line-196"></a>    <span class="c1">//!   Main::finalize() at some point in the future when all work has been</span>
<a name="line-197"></a>    <span class="c1">//!   finished. finalize() then exits by calling Charm++&#39;s CkExit(),</span>
<a name="line-198"></a>    <span class="c1">//!   shutting down the runtime system.</span>
<a name="line-199"></a>    <span class="c1">//! \see http://charm.cs.illinois.edu/manuals/html/charm++/manual.html</span>
<a name="line-200"></a>    <span class="n">Main</span><span class="p">(</span> <span class="n">CkArgMsg</span><span class="o">*</span> <span class="n">msg</span> <span class="p">)</span>
<a name="line-201"></a>    <span class="k">try</span> <span class="o">:</span>
<a name="line-202"></a>      <span class="n">m_helped</span><span class="p">(</span> <span class="nb">false</span> <span class="p">),</span>
<a name="line-203"></a>      <span class="n">m_cmdline</span><span class="p">(),</span>
<a name="line-204"></a>      <span class="c1">// Parse command line into m_cmdline using default simple pretty printer</span>
<a name="line-205"></a>      <span class="n">m_cmdParser</span><span class="p">(</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">argc</span><span class="p">,</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">argv</span><span class="p">,</span> <span class="n">tk</span><span class="o">::</span><span class="n">Print</span><span class="p">(),</span> <span class="n">m_cmdline</span><span class="p">,</span> <span class="n">m_helped</span> <span class="p">),</span>
<a name="line-206"></a>      <span class="c1">// Create pretty printer initializing output streams based on command line</span>
<a name="line-207"></a>      <span class="n">m_print</span><span class="p">(</span> <span class="n">m_cmdline</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span> <span class="n">tag</span><span class="o">::</span><span class="n">verbose</span> <span class="o">&gt;</span><span class="p">()</span> <span class="o">?</span> <span class="n">std</span><span class="o">::</span><span class="nl">cout</span> <span class="p">:</span> <span class="n">std</span><span class="o">::</span><span class="n">clog</span> <span class="p">),</span>
<a name="line-208"></a>      <span class="c1">// Create UnitTest driver</span>
<a name="line-209"></a>      <span class="n">m_driver</span><span class="p">(</span> <span class="n">tk</span><span class="o">::</span><span class="n">Main</span><span class="o">&lt;</span> <span class="n">unittest</span><span class="o">::</span><span class="n">UnitTestDriver</span> <span class="o">&gt;</span>
<a name="line-210"></a>                        <span class="p">(</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">argc</span><span class="p">,</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">argv</span><span class="p">,</span>
<a name="line-211"></a>                          <span class="n">m_cmdline</span><span class="p">,</span>
<a name="line-212"></a>                          <span class="n">tk</span><span class="o">::</span><span class="n">HeaderType</span><span class="o">::</span><span class="n">UNITTEST</span><span class="p">,</span>
<a name="line-213"></a>                          <span class="n">UNITTEST_EXECUTABLE</span><span class="p">,</span>
<a name="line-214"></a>                          <span class="n">m_print</span> <span class="p">)</span> <span class="p">),</span>
<a name="line-215"></a>      <span class="n">m_timer</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="c1">// Start new timer measuring the serial+Charm++ runtime</span>
<a name="line-216"></a>      <span class="n">m_timestamp</span><span class="p">()</span>
<a name="line-217"></a>    <span class="p">{</span>
<a name="line-218"></a>      <span class="c1">// Immediately exit if any help was requested; help is printed in main()</span>
<a name="line-219"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">m_helped</span><span class="p">)</span> <span class="n">CkExit</span><span class="p">();</span>
<a name="line-220"></a>      <span class="c1">// Save executable name to global-scope string so FileParser can access it</span>
<a name="line-221"></a>      <span class="n">unittest</span><span class="o">::</span><span class="n">g_executable</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a name="line-222"></a>      <span class="k">delete</span> <span class="n">msg</span><span class="p">;</span>
<a name="line-223"></a>      <span class="n">mainProxy</span> <span class="o">=</span> <span class="n">thisProxy</span><span class="p">;</span>
<a name="line-224"></a>      <span class="c1">// Fire up an asynchronous execute object, which when created at some</span>
<a name="line-225"></a>      <span class="c1">// future point in time will call back to this-&gt;execute(). This is</span>
<a name="line-226"></a>      <span class="c1">// necessary so that this-&gt;execute() can access already migrated</span>
<a name="line-227"></a>      <span class="c1">// global-scope data.</span>
<a name="line-228"></a>      <span class="n">CProxy_execute</span><span class="o">::</span><span class="n">ckNew</span><span class="p">();</span>
<a name="line-229"></a>      <span class="c1">// Start new timer measuring the migration of global-scope data</span>
<a name="line-230"></a>      <span class="n">m_timer</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">();</span>
<a name="line-231"></a>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span> <span class="n">tk</span><span class="o">::</span><span class="n">processExceptionCharm</span><span class="p">();</span> <span class="p">}</span>
<a name="line-232"></a>
<a name="line-233"></a>    <span class="kt">void</span> <span class="n">execute</span><span class="p">()</span> <span class="p">{</span>
<a name="line-234"></a>      <span class="k">try</span> <span class="p">{</span>
<a name="line-235"></a>        <span class="n">m_timestamp</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&quot;Migrate global-scope data&quot;</span><span class="p">,</span> <span class="n">m_timer</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">hms</span><span class="p">());</span>
<a name="line-236"></a>        <span class="n">m_driver</span><span class="p">.</span><span class="n">execute</span><span class="p">();</span>       <span class="c1">// fires up async chares</span>
<a name="line-237"></a>      <span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span> <span class="n">tk</span><span class="o">::</span><span class="n">processExceptionCharm</span><span class="p">();</span> <span class="p">}</span>
<a name="line-238"></a>    <span class="p">}</span>
<a name="line-239"></a>
<a name="line-240"></a>    <span class="kt">void</span> <span class="n">finalize</span><span class="p">(</span> <span class="kt">bool</span> <span class="n">worked</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">pass</span> <span class="p">)</span> <span class="p">{</span>
<a name="line-241"></a>      <span class="k">try</span> <span class="p">{</span>
<a name="line-242"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">worked</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">m_timer</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
<a name="line-243"></a>          <span class="n">m_timestamp</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="s">&quot;Serial and Charm++ tests runtime&quot;</span><span class="p">,</span>
<a name="line-244"></a>                                    <span class="n">m_timer</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">hms</span><span class="p">()</span> <span class="p">);</span>
<a name="line-245"></a>          <span class="n">m_print</span><span class="p">.</span><span class="n">time</span><span class="p">(</span> <span class="s">&quot;Serial and Charm++ test suite timers (h:m:s)&quot;</span><span class="p">,</span>
<a name="line-246"></a>                        <span class="n">m_timestamp</span> <span class="p">);</span>
<a name="line-247"></a>          <span class="n">m_print</span><span class="p">.</span><span class="n">endpart</span><span class="p">();</span>
<a name="line-248"></a>        <span class="p">}</span>
<a name="line-249"></a>      <span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span> <span class="n">tk</span><span class="o">::</span><span class="n">processExceptionCharm</span><span class="p">();</span> <span class="p">}</span>
<a name="line-250"></a>      <span class="c1">// Set global bool indicating whether all tests have passed</span>
<a name="line-251"></a>      <span class="n">unittest</span><span class="o">::</span><span class="n">g_charmpass</span> <span class="o">=</span> <span class="n">pass</span><span class="p">;</span>
<a name="line-252"></a>      <span class="c1">// Tell the Charm++ runtime system to exit</span>
<a name="line-253"></a>      <span class="n">CkExit</span><span class="p">();</span>
<a name="line-254"></a>    <span class="p">}</span>
<a name="line-255"></a>
<a name="line-256"></a>  <span class="k">private</span><span class="o">:</span>
<a name="line-257"></a>    <span class="kt">bool</span> <span class="n">m_helped</span><span class="p">;</span>      <span class="c1">//!&lt; Indicates if help was requested on the command line</span>
<a name="line-258"></a>    <span class="n">unittest</span><span class="o">::</span><span class="n">ctr</span><span class="o">::</span><span class="n">CmdLine</span> <span class="n">m_cmdline</span><span class="p">;</span>                   <span class="c1">//!&lt; Command line</span>
<a name="line-259"></a>    <span class="n">unittest</span><span class="o">::</span><span class="n">CmdLineParser</span> <span class="n">m_cmdParser</span><span class="p">;</span>                <span class="c1">//!&lt; Command line parser</span>
<a name="line-260"></a>    <span class="n">unittest</span><span class="o">::</span><span class="n">UnitTestPrint</span> <span class="n">m_print</span><span class="p">;</span>                    <span class="c1">//!&lt; Pretty printer</span>
<a name="line-261"></a>    <span class="n">unittest</span><span class="o">::</span><span class="n">UnitTestDriver</span> <span class="n">m_driver</span><span class="p">;</span>                  <span class="c1">//!&lt; Driver</span>
<a name="line-262"></a>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">tk</span><span class="o">::</span><span class="n">Timer</span> <span class="o">&gt;</span> <span class="n">m_timer</span><span class="p">;</span>                   <span class="c1">//!&lt; Timers</span>
<a name="line-263"></a>
<a name="line-264"></a>    <span class="c1">//! Time stamps in h:m:s with labels</span>
<a name="line-265"></a>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">tk</span><span class="o">::</span><span class="n">Timer</span><span class="o">::</span><span class="n">Watch</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">m_timestamp</span><span class="p">;</span>
<a name="line-266"></a><span class="p">};</span>
<a name="line-267"></a>
<a name="line-268"></a><span class="c1">//! \brief Charm++ chare execute</span>
<a name="line-269"></a><span class="c1">//! \details By the time this object is constructed, the Charm++ runtime system</span>
<a name="line-270"></a><span class="c1">//!    has finished migrating all global-scoped read-only objects which happens</span>
<a name="line-271"></a><span class="c1">//!    after the main chare constructor has finished.</span>
<a name="line-272"></a><span class="c1">//! \author J. Bakosi</span>
<a name="line-273"></a><span class="k">class</span> <span class="nc">execute</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CBase_execute</span> <span class="p">{</span>
<a name="line-274"></a> <span class="k">public</span><span class="o">:</span> <span class="n">execute</span><span class="p">()</span> <span class="p">{</span> <span class="n">mainProxy</span><span class="p">.</span><span class="n">execute</span><span class="p">();</span> <span class="p">}</span>
<a name="line-275"></a><span class="p">};</span>
<a name="line-276"></a>
<a name="line-277"></a><span class="c1">//! \brief UnitTest main()</span>
<a name="line-278"></a><span class="c1">//! \details UnitTest does have a main() function so that we can have tests</span>
<a name="line-279"></a><span class="c1">//!   calling MPI functions. Thus we are using Charm++&#39;s MPI-interoperation</span>
<a name="line-280"></a><span class="c1">//!   capability as would have to be done with interoperation with an MPI</span>
<a name="line-281"></a><span class="c1">//!   library. This is necessary, since MPI_Init() is a bit adamant about</span>
<a name="line-282"></a><span class="c1">//!   capturing resources it wants and hence it has to be called before Charm is</span>
<a name="line-283"></a><span class="c1">//!   initialized.</span>
<a name="line-284"></a><span class="c1">//! \author J. Bakosi</span>
<a name="line-285"></a><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span> <span class="p">)</span> <span class="p">{</span>
<a name="line-286"></a>
<a name="line-287"></a>  <span class="kt">int</span> <span class="n">peid</span><span class="p">,</span> <span class="n">numpes</span><span class="p">;</span>
<a name="line-288"></a>  
<a name="line-289"></a>  <span class="cp">#if defined(__clang__)</span>
<a name="line-290"></a>    <span class="cp">#pragma clang diagnostic push</span>
<a name="line-291"></a>    <span class="cp">#pragma clang diagnostic ignored &quot;-Wold-style-cast&quot;</span>
<a name="line-292"></a>  <span class="cp">#endif</span>
<a name="line-293"></a>
<a name="line-294"></a>  <span class="c1">// Initialize MPI</span>
<a name="line-295"></a>  <span class="n">MPI_Init</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">argv</span> <span class="p">);</span>
<a name="line-296"></a>  <span class="n">MPI_Comm_rank</span><span class="p">(</span> <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">peid</span> <span class="p">);</span>
<a name="line-297"></a>  <span class="n">MPI_Comm_size</span><span class="p">(</span> <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">numpes</span> <span class="p">);</span>
<a name="line-298"></a>
<a name="line-299"></a>  <span class="c1">// Run serial and Charm++ unit test suite</span>
<a name="line-300"></a>  <span class="n">CharmLibInit</span><span class="p">(</span> <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span> <span class="p">);</span>
<a name="line-301"></a>  <span class="n">CharmLibExit</span><span class="p">();</span>
<a name="line-302"></a>
<a name="line-303"></a>  <span class="kt">bool</span> <span class="n">mpipass</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<a name="line-304"></a>
<a name="line-305"></a>  <span class="c1">// Lambda to compute exit code based on test failures and exit. This is the</span>
<a name="line-306"></a>  <span class="c1">// single exit point and we must exit from the program.</span>
<a name="line-307"></a>  <span class="k">auto</span> <span class="n">stop</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpes</span><span class="p">](</span><span class="kt">int</span> <span class="n">pass</span><span class="p">)</span> <span class="p">{</span>
<a name="line-308"></a>    <span class="c1">// Combine pass-status from Charm++/serial and MPI suites</span>
<a name="line-309"></a>    <span class="kt">int</span> <span class="n">mypass</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">::</span><span class="n">g_charmpass</span> <span class="o">&amp;&amp;</span> <span class="n">pass</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-310"></a>    <span class="c1">// Add up every PE&#39;s pass status</span>
<a name="line-311"></a>    <span class="kt">int</span> <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-312"></a>    <span class="n">MPI_Allreduce</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">mypass</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INT</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">MPI_COMM_WORLD</span> <span class="p">);</span>
<a name="line-313"></a>    <span class="c1">// Exit code: g==numpes: pass, g&lt;numpes: fail</span>
<a name="line-314"></a>    <span class="n">g</span> <span class="o">/=</span> <span class="n">numpes</span><span class="p">;</span>
<a name="line-315"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">g</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a name="line-316"></a>      <span class="n">MPI_Finalize</span><span class="p">();</span>   <span class="c1">// will pass exit code 0 to shell</span>
<a name="line-317"></a>    <span class="k">else</span>
<a name="line-318"></a>      <span class="n">MPI_Abort</span><span class="p">(</span> <span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="n">tk</span><span class="o">::</span><span class="n">ErrCode</span><span class="o">::</span><span class="n">FAILURE</span> <span class="p">);</span> <span class="c1">// nonzero exit code</span>
<a name="line-319"></a>    <span class="c1">// Since this is an MPI program, the exit code passed to exit() does not</span>
<a name="line-320"></a>    <span class="c1">// matter, however, calling exit() here is important, because we must exit.</span>
<a name="line-321"></a>    <span class="n">exit</span><span class="p">(</span> <span class="n">tk</span><span class="o">::</span><span class="n">ErrCode</span><span class="o">::</span><span class="n">SUCCESS</span> <span class="p">);</span>
<a name="line-322"></a>  <span class="p">};</span>
<a name="line-323"></a>
<a name="line-324"></a>  <span class="cp">#if defined(__clang__)</span>
<a name="line-325"></a>    <span class="cp">#pragma clang diagnostic pop</span>
<a name="line-326"></a>  <span class="cp">#endif</span>
<a name="line-327"></a>
<a name="line-328"></a>  <span class="c1">// Run MPI test suite</span>
<a name="line-329"></a>  <span class="k">try</span> <span class="p">{</span>
<a name="line-330"></a>
<a name="line-331"></a>    <span class="n">tk</span><span class="o">::</span><span class="n">Print</span> <span class="n">print</span><span class="p">;</span>    <span class="c1">// quiet output by default using print, see ctor</span>
<a name="line-332"></a>    <span class="n">unittest</span><span class="o">::</span><span class="n">ctr</span><span class="o">::</span><span class="n">CmdLine</span> <span class="n">cmdline</span><span class="p">;</span>
<a name="line-333"></a>    <span class="kt">bool</span> <span class="n">helped</span><span class="p">;</span>
<a name="line-334"></a>    <span class="n">unittest</span><span class="o">::</span><span class="n">CmdLineParser</span> <span class="n">cmdParser</span><span class="p">(</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">print</span><span class="p">,</span> <span class="n">cmdline</span><span class="p">,</span> <span class="n">helped</span> <span class="p">);</span>
<a name="line-335"></a>
<a name="line-336"></a>    <span class="c1">// Print out help on all command-line arguments if help was requested</span>
<a name="line-337"></a>    <span class="k">const</span> <span class="k">auto</span> <span class="n">helpcmd</span> <span class="o">=</span> <span class="n">cmdline</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span> <span class="n">tag</span><span class="o">::</span><span class="n">help</span> <span class="o">&gt;</span><span class="p">();</span>
<a name="line-338"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">peid</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">helpcmd</span><span class="p">)</span>
<a name="line-339"></a>      <span class="n">print</span><span class="p">.</span><span class="n">help</span><span class="o">&lt;</span> <span class="n">tk</span><span class="o">::</span><span class="n">QUIET</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">UNITTEST_EXECUTABLE</span><span class="p">,</span>
<a name="line-340"></a>                               <span class="n">cmdline</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span> <span class="n">tag</span><span class="o">::</span><span class="n">cmdinfo</span> <span class="o">&gt;</span><span class="p">(),</span>
<a name="line-341"></a>                               <span class="s">&quot;Command-line Parameters:&quot;</span><span class="p">,</span> <span class="s">&quot;-&quot;</span> <span class="p">);</span>
<a name="line-342"></a>
<a name="line-343"></a>    <span class="c1">// Print out verbose help for a single keyword if requested</span>
<a name="line-344"></a>    <span class="k">const</span> <span class="k">auto</span> <span class="n">helpkw</span> <span class="o">=</span> <span class="n">cmdline</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span> <span class="n">tag</span><span class="o">::</span><span class="n">helpkw</span> <span class="o">&gt;</span><span class="p">();</span>
<a name="line-345"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">peid</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">helpkw</span><span class="p">.</span><span class="n">keyword</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
<a name="line-346"></a>      <span class="n">print</span><span class="p">.</span><span class="n">helpkw</span><span class="o">&lt;</span> <span class="n">tk</span><span class="o">::</span><span class="n">QUIET</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">UNITTEST_EXECUTABLE</span><span class="p">,</span> <span class="n">helpkw</span> <span class="p">);</span>
<a name="line-347"></a>
<a name="line-348"></a>    <span class="c1">// Immediately exit if any help was output</span>
<a name="line-349"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">helpcmd</span> <span class="o">||</span> <span class="o">!</span><span class="n">helpkw</span><span class="p">.</span><span class="n">keyword</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="n">stop</span><span class="p">(</span> <span class="n">mpipass</span> <span class="p">);</span>
<a name="line-350"></a>
<a name="line-351"></a>    <span class="n">unittest</span><span class="o">::</span><span class="n">UnitTestPrint</span>
<a name="line-352"></a>      <span class="n">uprint</span><span class="p">(</span> <span class="n">cmdline</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span> <span class="n">tag</span><span class="o">::</span><span class="n">verbose</span> <span class="o">&gt;</span><span class="p">()</span> <span class="o">?</span> <span class="n">std</span><span class="o">::</span><span class="nl">cout</span> <span class="p">:</span> <span class="n">std</span><span class="o">::</span><span class="n">clog</span> <span class="p">);</span>
<a name="line-353"></a>
<a name="line-354"></a>    <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">::</span><span class="n">g_runner</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">list_groups</span><span class="p">();</span>
<a name="line-355"></a>
<a name="line-356"></a>    <span class="c1">// Get group name string passed in by -g</span>
<a name="line-357"></a>    <span class="k">const</span> <span class="k">auto</span> <span class="n">grp</span> <span class="o">=</span> <span class="n">cmdline</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span> <span class="n">tag</span><span class="o">::</span><span class="n">group</span> <span class="o">&gt;</span><span class="p">();</span>
<a name="line-358"></a>
<a name="line-359"></a>    <span class="c1">// If only select groups to be run, see if there is any that will run</span>
<a name="line-360"></a>    <span class="kt">bool</span> <span class="n">work</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<a name="line-361"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">grp</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
<a name="line-362"></a>      <span class="n">work</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<a name="line-363"></a>    <span class="k">else</span>
<a name="line-364"></a>      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">g</span> <span class="p">:</span> <span class="n">groups</span><span class="p">)</span>
<a name="line-365"></a>        <span class="k">if</span> <span class="p">(</span> <span class="n">g</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;MPI&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span> <span class="o">&amp;&amp;</span>  <span class="c1">// only consider MPI groups</span>
<a name="line-366"></a>             <span class="n">g</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span> <span class="p">)</span>
<a name="line-367"></a>          <span class="n">work</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<a name="line-368"></a>
<a name="line-369"></a>    <span class="c1">// Quit if there is no work to be done</span>
<a name="line-370"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">work</span><span class="p">)</span> <span class="p">{</span>
<a name="line-371"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">peid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-372"></a>        <span class="n">uprint</span><span class="p">.</span><span class="n">note</span><span class="p">(</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">No MPI test groups to be executed because no test &quot;</span>
<a name="line-373"></a>                     <span class="s">&quot;group names match &#39;&quot;</span> <span class="o">+</span> <span class="n">grp</span> <span class="o">+</span> <span class="s">&quot;&#39;.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
<a name="line-374"></a>      <span class="n">stop</span><span class="p">(</span> <span class="n">mpipass</span> <span class="p">);</span>
<a name="line-375"></a>    <span class="p">}</span>
<a name="line-376"></a>
<a name="line-377"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">peid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-378"></a>      <span class="n">uprint</span><span class="p">.</span><span class="n">endpart</span><span class="p">();</span>
<a name="line-379"></a>      <span class="n">uprint</span><span class="p">.</span><span class="n">part</span><span class="p">(</span> <span class="s">&quot;MPI unit test suite&quot;</span> <span class="p">);</span>
<a name="line-380"></a>      <span class="n">uprint</span><span class="p">.</span><span class="n">unithead</span><span class="p">(</span> <span class="s">&quot;Unit tests computed&quot;</span><span class="p">,</span> <span class="n">cmdline</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span> <span class="n">tag</span><span class="o">::</span><span class="n">group</span> <span class="o">&gt;</span><span class="p">()</span> <span class="p">);</span>
<a name="line-381"></a>    <span class="p">}</span>
<a name="line-382"></a>
<a name="line-383"></a>    <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">nrun</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncomplete</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nwarn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nskip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nexcp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nfail</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<a name="line-384"></a>    <span class="n">tk</span><span class="o">::</span><span class="n">Timer</span> <span class="n">timer</span><span class="p">;</span>  <span class="c1">// start new timer measuring the MPI-suite runtime</span>
<a name="line-385"></a>
<a name="line-386"></a>    <span class="c1">// Lambda to fire up all tests in a test group</span>
<a name="line-387"></a>    <span class="k">auto</span> <span class="n">spawngrp</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">g</span> <span class="p">)</span> <span class="p">{</span>
<a name="line-388"></a>      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">t</span><span class="o">&lt;=</span><span class="n">unittest</span><span class="o">::</span><span class="n">g_maxTestsInGroup</span><span class="p">;</span> <span class="o">++</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span>
<a name="line-389"></a>        <span class="n">tut</span><span class="o">::</span><span class="n">test_result</span> <span class="n">tr</span><span class="p">;</span>
<a name="line-390"></a>        <span class="n">unittest</span><span class="o">::</span><span class="n">g_runner</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">run_test</span><span class="p">(</span> <span class="n">g</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">tr</span> <span class="p">);</span>
<a name="line-391"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">peid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-392"></a>          <span class="o">++</span><span class="n">nrun</span><span class="p">;</span>
<a name="line-393"></a>          <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&gt;</span> <span class="n">status</span>
<a name="line-394"></a>            <span class="p">{</span> <span class="n">tr</span><span class="p">.</span><span class="n">group</span><span class="p">,</span> <span class="n">tr</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">tr</span><span class="p">.</span><span class="n">result</span><span class="p">),</span> <span class="n">tr</span><span class="p">.</span><span class="n">message</span><span class="p">,</span>
<a name="line-395"></a>              <span class="n">tr</span><span class="p">.</span><span class="n">exception_typeid</span> <span class="p">};</span>
<a name="line-396"></a>          <span class="n">unittest</span><span class="o">::</span><span class="n">evaluate</span><span class="p">(</span> <span class="n">status</span><span class="p">,</span> <span class="n">ncomplete</span><span class="p">,</span> <span class="n">nwarn</span><span class="p">,</span> <span class="n">nskip</span><span class="p">,</span> <span class="n">nexcp</span><span class="p">,</span> <span class="n">nfail</span> <span class="p">);</span>
<a name="line-397"></a>          <span class="n">uprint</span><span class="p">.</span><span class="n">test</span><span class="p">(</span> <span class="n">ncomplete</span><span class="p">,</span> <span class="n">nfail</span><span class="p">,</span> <span class="n">status</span> <span class="p">);</span>
<a name="line-398"></a>        <span class="p">}</span>
<a name="line-399"></a>      <span class="p">}</span>
<a name="line-400"></a>    <span class="p">};</span>
<a name="line-401"></a>
<a name="line-402"></a>    <span class="c1">// Fire up all tests in all test groups exercising MPI on rank 0</span>
<a name="line-403"></a>    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">g</span> <span class="p">:</span> <span class="n">groups</span><span class="p">)</span>
<a name="line-404"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;MPI&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// only start MPI test groups</span>
<a name="line-405"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">grp</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>                        <span class="c1">// consider all test groups</span>
<a name="line-406"></a>          <span class="n">spawngrp</span><span class="p">(</span> <span class="n">g</span> <span class="p">);</span>
<a name="line-407"></a>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
<a name="line-408"></a>          <span class="c1">// spawn only the groups that match the string specified via -g string</span>
<a name="line-409"></a>          <span class="n">spawngrp</span><span class="p">(</span> <span class="n">g</span> <span class="p">);</span>
<a name="line-410"></a>        <span class="p">}</span>
<a name="line-411"></a>      <span class="p">}</span>
<a name="line-412"></a>
<a name="line-413"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">peid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-414"></a>      <span class="n">mpipass</span> <span class="o">=</span>
<a name="line-415"></a>       <span class="n">unittest</span><span class="o">::</span><span class="n">assess</span><span class="p">(</span> <span class="n">uprint</span><span class="p">,</span> <span class="s">&quot;MPI&quot;</span><span class="p">,</span> <span class="n">nfail</span><span class="p">,</span> <span class="n">nwarn</span><span class="p">,</span> <span class="n">nskip</span><span class="p">,</span> <span class="n">nexcp</span><span class="p">,</span> <span class="n">ncomplete</span> <span class="p">);</span>
<a name="line-416"></a>      <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">tk</span><span class="o">::</span><span class="n">Timer</span><span class="o">::</span><span class="n">Watch</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">timestamp</span><span class="p">;</span>
<a name="line-417"></a>      <span class="n">timestamp</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="s">&quot;MPI tests runtime&quot;</span><span class="p">,</span> <span class="n">timer</span><span class="p">.</span><span class="n">hms</span><span class="p">()</span> <span class="p">);</span>
<a name="line-418"></a>      <span class="n">uprint</span><span class="p">.</span><span class="n">time</span><span class="p">(</span> <span class="s">&quot;MPI test suite timers (h:m:s)&quot;</span><span class="p">,</span> <span class="n">timestamp</span> <span class="p">);</span>
<a name="line-419"></a>    <span class="p">}</span>
<a name="line-420"></a>
<a name="line-421"></a>  <span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span> <span class="n">tk</span><span class="o">::</span><span class="n">processExceptionMPI</span><span class="p">();</span> <span class="p">}</span>
<a name="line-422"></a>
<a name="line-423"></a>  <span class="n">stop</span><span class="p">(</span> <span class="n">mpipass</span> <span class="p">);</span>
<a name="line-424"></a><span class="p">}</span>
<a name="line-425"></a>
<a name="line-426"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/charmchild.def.h&quot;</span><span class="cp"></span>
<a name="line-427"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/charmtimer.def.h&quot;</span><span class="cp"></span>
<a name="line-428"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/migrated.def.h&quot;</span><span class="cp"></span>
<a name="line-429"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/testarray.def.h&quot;</span><span class="cp"></span>
<a name="line-430"></a><span class="cp">#include</span> <span class="cpf">&quot;NoWarning/unittest.def.h&quot;</span><span class="cp"></span>
</pre></div>
</td></tr></table>
      </div>
      <div id="footer">
        <p>
         Cppcheck 1.76.1 - a tool for static C/C++ code analysis</br>
         </br>
         Internet: <a href="http://cppcheck.net">http://cppcheck.net</a></br>
         IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a></br>
        <p>
      </div>
  </body>
</html>
