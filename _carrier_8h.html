<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quinoa: /tmp/q/quinoa/src/Inciter/Carrier.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quinoa.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Quinoa
   </div>
   <div id="projectbrief">Adaptive computational fluid dynamics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_606df7a4664720c111e6e5b0e11c4e03.html">Inciter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<div class="title">Carrier.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Carrier advances a system of transport equations.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;array&gt;</code><br />
<code>#include &lt;cstddef&gt;</code><br />
<code>#include &lt;iosfwd&gt;</code><br />
<code>#include &lt;utility&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
<code>#include &lt;cstring&gt;</code><br />
<code>#include &lt;cmath&gt;</code><br />
<code>#include &lt;unordered_map&gt;</code><br />
<code>#include &lt;unordered_set&gt;</code><br />
<code>#include &lt;set&gt;</code><br />
<code>#include &quot;Types.h&quot;</code><br />
<code>#include &quot;<a class="el" href="_fields_8h_source.html">Fields.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_tracker_8h_source.html">Tracker.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_derived_data_8h_source.html">DerivedData.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_vector_reducer_8h_source.html">VectorReducer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_flux_corrector_8h_source.html">FluxCorrector.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_inciter_2_input_deck_2_input_deck_8h_source.html">Inciter/InputDeck/InputDeck.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="transporter_8decl_8h_source.html">NoWarning/transporter.decl.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="carrier_8decl_8h_source.html">NoWarning/carrier.decl.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="particlewriter_8decl_8h_source.html">NoWarning/particlewriter.decl.h</a>&quot;</code><br />
</div>
<p><a href="_carrier_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classinciter_1_1_carrier.html">inciter::Carrier</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classinciter_1_1_carrier.html" title="Carrier Charm++ chare array used to advance transport equations in time. ">Carrier</a> Charm++ chare array used to advance transport equations in time.  <a href="classinciter_1_1_carrier.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacetk"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacetk.html">tk</a></td></tr>
<tr class="memdesc:namespacetk"><td class="mdescLeft">&#160;</td><td class="mdescRight">Toolkit declarations and definitions for general purpose utilities. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespaceinciter"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceinciter.html">inciter</a></td></tr>
<tr class="memdesc:namespaceinciter"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inciter declarations and definitions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Carrier advances a system of transport equations. </p>
<dl class="section author"><dt>Author</dt><dd>J. Bakosi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Fri 17 Mar 2017 11:29:15 AM MDT </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2012-2015, Jozsef Bakosi, 2016, Los Alamos National Security, LLC.</dd></dl>
<p>Carrier advances a system of transport equations. There are a potentially large number of Carrier Charm++ chares created by Transporter. Each carrier gets a chunk of the full load (part of the mesh) and does the same: initializes and advances a system of systems of PDEs in time.</p>
<p>The implementation uses the Charm++ runtime system and is fully asynchronous, overlapping computation and communication. The algorithm utilizes the structured dagger (SDAG) Charm++ functionality. The high-level overview of the algorithm structure and how it interfaces with Charm++ is discussed in the Charm++ interface file <a class="el" href="carrier_8ci.html">src/Inciter/carrier.ci</a>.</p>
<h4>Call graph</h4>
<p>The following is a directed acyclic graph (DAG) that outlines the asynchronous algorithm implemented in this class The detailed discussion of the algorithm is given in the Charm++ interface file <a class="el" href="transporter_8ci.html">transporter.ci</a>, which also repeats the graph below using ASCII graphics. On the DAG orange fills denote global synchronization points that contain or eventually lead to global reductions. Dashed lines are potential shortcuts that allow jumping over some of the task-graph under some circumstances or optional code paths (taken, e.g., only in DEBUG mode). See the detailed discussion in <a class="el" href="carrier_8ci.html">carrier.ci</a>. </p><div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_1.svg" width="330" height="280"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
 <div class="fragment"><div class="line">// *****************************************************************************</div><div class="line">/*!</div><div class="line">  \file      src/Inciter/carrier.ci</div><div class="line">  \author    J. Bakosi</div><div class="line">  \date      Fri 17 Mar 2017 11:28:46 AM MDT</div><div class="line">  \copyright 2012-2015, Jozsef Bakosi, 2016, Los Alamos National Security, LLC.</div><div class="line">  \brief     Charm++ module interface file for Carrier</div><div class="line">  \details   Charm++ module interface file for Carrier</div><div class="line">*/</div><div class="line">// *****************************************************************************</div><div class="line"></div><div class="line">module carrier {</div><div class="line"></div><div class="line">  extern module transporter;</div><div class="line">  extern module linsysmerger;</div><div class="line">  extern module particlewriter;</div><div class="line"></div><div class="line">  include &quot;Particles.h&quot;;</div><div class="line">  include &quot;AuxSolver.h&quot;;</div><div class="line">  include &quot;UnsMesh.h&quot;;</div><div class="line"></div><div class="line">  namespace inciter {</div><div class="line"></div><div class="line">    array [1D] Carrier {</div><div class="line">      entry</div><div class="line">        Carrier( const CProxy_Transporter&amp; transporter,</div><div class="line">                 const tk::CProxy_LinSysMerger&lt; CProxy_Transporter,</div><div class="line">                                                CProxy_Carrier,</div><div class="line">                                                AuxSolverLumpMassDiff &gt;&amp; lsm,</div><div class="line">                 const tk::CProxy_ParticleWriter&lt; CProxy_Transporter &gt;&amp; pw,</div><div class="line">                 const std::vector&lt; std::size_t &gt;&amp; conn,</div><div class="line">                 const std::unordered_map&lt; int,</div><div class="line">                         std::unordered_set&lt; std::size_t &gt; &gt;&amp; msum,</div><div class="line">                 const std::unordered_map&lt; std::size_t, std::size_t &gt;&amp; filenodes,</div><div class="line">                 const tk::UnsMesh::EdgeNodes&amp; edgenodes,</div><div class="line">                 int ncarr );</div><div class="line">      initnode void registerReducers();</div><div class="line">      entry void vol();</div><div class="line">      entry void comvol( const std::vector&lt; std::size_t &gt;&amp; gid,</div><div class="line">                         const std::vector&lt; tk::real &gt;&amp; V );</div><div class="line">      entry void setup();</div><div class="line">      entry void init();</div><div class="line">      entry void updateSol( const std::vector&lt; std::size_t &gt;&amp; gid,</div><div class="line">                            const std::vector&lt; tk::real &gt;&amp; sol );</div><div class="line">      entry void updateLowSol( const std::vector&lt; std::size_t &gt;&amp; gid,</div><div class="line">                               const std::vector&lt; tk::real &gt;&amp; sol );</div><div class="line">      entry void</div><div class="line">        advance( uint8_t stage, tk::real newdt, uint64_t it, tk::real t );</div><div class="line">      entry void dt();</div><div class="line">      entry void findpar( int fromch,</div><div class="line">                          const std::vector&lt; std::size_t &gt;&amp; miss,</div><div class="line">                          const std::vector&lt; std::vector&lt; tk::real &gt; &gt;&amp; ps );</div><div class="line">      entry void foundpar( const std::vector&lt; std::size_t &gt;&amp; found );</div><div class="line">      entry void collectpar( int fromch,</div><div class="line">                             const std::vector&lt; std::size_t &gt;&amp; miss,</div><div class="line">                             const std::vector&lt; std::vector&lt; tk::real &gt; &gt;&amp; ps );</div><div class="line">      entry void collectedpar( const std::vector&lt; std::size_t &gt;&amp; found );</div><div class="line">      entry void out();</div><div class="line">      entry void doWriteParticles();</div><div class="line">      entry void comaec( const std::vector&lt; std::size_t &gt;&amp; gid,</div><div class="line">                         const std::vector&lt; std::vector&lt; tk::real &gt; &gt;&amp; P );</div><div class="line">      entry void comalw( const std::vector&lt; std::size_t &gt;&amp; gid,</div><div class="line">                         const std::vector&lt; std::vector&lt; tk::real &gt; &gt;&amp; Q );</div><div class="line">      entry void comlim( const std::vector&lt; std::size_t &gt;&amp; gid,</div><div class="line">                         const std::vector&lt; std::vector&lt; tk::real &gt; &gt;&amp; U );</div><div class="line"></div><div class="line">      // SDAG code follows. See http://charm.cs.illinois.edu/manuals/html/</div><div class="line">      // charm++/manual.html, Sec. &quot;Structured Control Flow: Structured Dagger&quot;.</div><div class="line"></div><div class="line">      // High-level overview of the dependency and asynchronous call structure</div><div class="line">      // ---------------------------------------------------------------------</div><div class="line">      //</div><div class="line">      // Directed Acyclic Graph (DAG):</div><div class="line">      // -----------------------------</div><div class="line">      //</div><div class="line">      // See src/Inciter/Carrier.h.</div><div class="line">      //</div><div class="line">      // Interpretation of the above DAG</div><div class="line">      // -------------------------------</div><div class="line">      // Control flow is from left to right and top to bottom.</div><div class="line">      //</div><div class="line">      // Only in DEBUG mode, wait4ver(): When the low and high order solutions</div><div class="line">      // have been updated, and the own portion of the antidiffusive element</div><div class="line">      // contributions (AEC) have been computed, we optionally (inly in DEBUG</div><div class="line">      // mode) verify that the AECs assembled to nodes equal to the difference</div><div class="line">      // between the high and low order increments. See also</div><div class="line">      // FluxCorrector::aec() and FluxCorrector::verify(). Note that this</div><div class="line">      // verification is only done if there is only a single Carrier chare as</div><div class="line">      // the correct verification would entail communication for multiple</div><div class="line">      // chares. Note also that the DAG conditions below for wait4ver() require</div><div class="line">      // the own contributions to the AEC and ALW instead of requiring the low</div><div class="line">      // and high order solutions and the own AEC. Requiring the former set (as</div><div class="line">      // implemented) is stronger than the latter, because the former can only</div><div class="line">      // be satisfied when the latter is also satisfied. The former is</div><div class="line">      // implemented because that avoids introducing two more SDAG messages,</div><div class="line">      // e.g., lo_complete() and hi_complete(), and that would require 3</div><div class="line">      // conditions instead of two, leading to simpler code.</div><div class="line">      //</div><div class="line">      // Computing limited antidiffusive element contributions, wait4fct():</div><div class="line">      // Computing and communicating contributions on chare-boundaries of</div><div class="line">      // antidiffusive element contributions (AEC), and the maximum and minimum</div><div class="line">      // unknowns of elements surrounding nodes (ALW) are overlapped. See</div><div class="line">      // aec(), comaec(), alw(), comalw(). When all are complete on a single</div><div class="line">      // chare, computing the limited antidiffusive element contributions can</div><div class="line">      // start.</div><div class="line">      //</div><div class="line">      // Applying the limited antidiffusive element contributions, wait4app():</div><div class="line">      // Computing the limited antidiffusive element contributions assembled and</div><div class="line">      // applied to mesh nodes involves own and contributions on the</div><div class="line">      // chare-boundary nodes. When both are done on a single chare, applying</div><div class="line">      // the new limited AECs can be done.</div><div class="line">      //</div><div class="line">      // Note that the none of wait4ver(), wait4fct(), and wait4app(), nor its</div><div class="line">      // underlying computations and communications involve global reductions or</div><div class="line">      // broadcasts: the entire FCT algorithm runs completely independent on</div><div class="line">      // each Carrier chare, and exercising task parallelism within.</div><div class="line"></div><div class="line">      #ifndef NDEBUG</div><div class="line">      entry void wait4ver() {</div><div class="line">        when ownaec_complete(), ownalw_complete() serial &quot;ver&quot; { verify(); } };</div><div class="line">      #endif</div><div class="line"></div><div class="line">      entry void wait4fct() {</div><div class="line">        when ownaec_complete(), comaec_complete(),</div><div class="line">             ownalw_complete(), comalw_complete() serial &quot;fct&quot; { lim(); } };</div><div class="line"></div><div class="line">      entry void wait4app() {</div><div class="line">        when ownlim_complete(), comlim_complete() serial &quot;app&quot; { apply(); } };</div><div class="line"></div><div class="line">      entry void ownaec_complete();</div><div class="line">      entry void ownalw_complete();</div><div class="line">      entry void ownlim_complete();</div><div class="line">      entry void comaec_complete();</div><div class="line">      entry void comalw_complete();</div><div class="line">      entry void comlim_complete();</div><div class="line">    };</div><div class="line"></div><div class="line">  } // inciter::</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> 
<p class="definition">Definition in file <a class="el" href="_carrier_8h_source.html">Carrier.h</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Apr 15 2017 05:39:28 for Quinoa by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
